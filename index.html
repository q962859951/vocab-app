<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æˆ‘çš„å•è¯æœ¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">

<style>
body{font-family:-apple-system;background:#ffffff;margin:0;padding:20px}
h1{text-align:center;font-size:20px}
input,button{width:100%;padding:12px;margin-top:10px;
border-radius:10px;border:1px solid #ddd;font-size:16px}
button{background:black;color:white;border:none}
.word{font-size:26px;text-align:center;margin:30px 0}
.small{font-size:14px;color:#555;margin-top:5px}
.result{text-align:center;font-weight:bold;margin-top:10px}
</style>
</head>
<body>

<h1>ğŸ“š æˆ‘çš„å•è¯æœ¬</h1>

<input id="newWord" placeholder="è¾“å…¥è‹±æ–‡å•è¯">
<input id="newMeaning" placeholder="è¾“å…¥ä¸­æ–‡æ„æ€">
<button onclick="addWord()">æ·»åŠ å•è¯</button>

<div class="word" id="showWord">ç‚¹å‡»å¼€å§‹</div>
<div id="example" class="small"></div>

<input id="answerInput" placeholder="è¾“å…¥ä¸­æ–‡æ„æ€">
<button onclick="speak()">ğŸ”Š å‘éŸ³</button>
<button onclick="generateExample()">ğŸ¤– GPTä¾‹å¥</button>
<button onclick="checkAnswer()">æäº¤</button>
<button onclick="nextWord()">ä¸‹ä¸€ä¸ª</button>

<div class="result" id="result"></div>

<script type="module">

// ğŸ”¹ Firebase é…ç½®
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ä½ çš„FirebaseKey",
  authDomain: "ä½ çš„AuthDomain",
  projectId: "ä½ çš„ProjectId"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let words=[];
let currentWord=null;

async function loadCloud(){
const snapshot=await getDocs(collection(db,"words"));
snapshot.forEach(doc=>words.push(doc.data()));
}
await loadCloud();

async function addWord(){
let w=newWord.value.trim();
let m=newMeaning.value.trim();
if(!w||!m) return;

let wordData={
word:w,meaning:m,correct:0,wrong:0,level:0,nextReview:Date.now()
};

await addDoc(collection(db,"words"),wordData);
words.push(wordData);

newWord.value="";
newMeaning.value="";
alert("æ·»åŠ æˆåŠŸ");
}

function getDue(){
return words.filter(w=>w.nextReview<=Date.now())
.sort((a,b)=>b.wrong-a.wrong);
}

function nextWord(){
let due=getDue();
if(due.length===0){alert("ä»Šæ—¥å®Œæˆ");return;}
currentWord=due[0];
showWord.innerText=currentWord.word;
result.innerText="";
answerInput.value="";
example.innerText="";
}

function checkAnswer(){
if(!currentWord) return;

if(answerInput.value.trim()===currentWord.meaning){
result.innerText="âœ… æ­£ç¡®";
currentWord.level++;
currentWord.correct++;
}else{
result.innerText="âŒ "+currentWord.meaning;
currentWord.level=0;
currentWord.wrong++;
}

let intervals=[5,30,720,1440,2880,10080];
let gap=intervals[Math.min(currentWord.level,5)];
currentWord.nextReview=Date.now()+gap*60000;
}

function speak(){
if(!currentWord) return;
let u=new SpeechSynthesisUtterance(currentWord.word);
u.lang="en-US";
speechSynthesis.speak(u);
}

// ğŸ¤– GPT ä¾‹å¥
async function generateExample(){
if(!currentWord) return;

example.innerText="ç”Ÿæˆä¸­...";

let res=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer ä½ çš„OpenAI_API_Key"
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[
{role:"system",content:"You are an IELTS teacher."},
{role:"user",content:`Write 2 high-quality IELTS sentences using "${currentWord.word}".`}
]
})
});

let data=await res.json();
example.innerText=data.choices[0].message.content;
}

</script>

</body>
</html>